# éƒ¨ç½²æ¦‚è§ˆ

> **ç›®æ ‡**: ç†è§£BPMIOCéƒ¨ç½²çš„å®Œæ•´æµç¨‹
> **éš¾åº¦**: â­â­â­
> **é¢„è®¡æ—¶é—´**: åŠå¤©
> **å‰ç½®çŸ¥è¯†**: BPMIOCæž¶æž„ã€LinuxåŸºç¡€

## ðŸ“‹ æœ¬æ–‡æ¡£å†…å®¹

1. éƒ¨ç½²æ¦‚è¿°
2. å¼€å‘çŽ¯å¢ƒ vs ç”Ÿäº§çŽ¯å¢ƒ
3. éƒ¨ç½²æž¶æž„
4. éƒ¨ç½²æµç¨‹
5. ç¡¬ä»¶è¦æ±‚
6. è½¯ä»¶ä¾èµ–

## 1ï¸âƒ£ éƒ¨ç½²æ¦‚è¿°

### ä»€ä¹ˆæ˜¯éƒ¨ç½²

**éƒ¨ç½²**ï¼šå°†åœ¨PCå¼€å‘çŽ¯å¢ƒä¸­å¼€å‘å’Œæµ‹è¯•çš„IOCåº”ç”¨ï¼Œè¿ç§»åˆ°çœŸå®žçš„ç›®æ ‡ç¡¬ä»¶ï¼ˆARMæ¿ã€æŽ§åˆ¶å™¨ï¼‰ä¸Šè¿è¡Œã€‚

### PCå¼€å‘ vs åµŒå…¥å¼éƒ¨ç½²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PCå¼€å‘çŽ¯å¢ƒ (x86_64)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  BPMIOCæºä»£ç                                â”‚          â”‚
â”‚  â”‚    â”œâ”€â”€ driverWrapper.c                    â”‚          â”‚
â”‚  â”‚    â”œâ”€â”€ devBPMMonitor.c                    â”‚          â”‚
â”‚  â”‚    â””â”€â”€ BPMmonitor.db                      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      â†“                                    â”‚
â”‚          ç¼–è¯‘ (gcc x86_64)                                â”‚
â”‚                      â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  bin/linux-x86_64/BPMmonitor (PCå¯æ‰§è¡Œæ–‡ä»¶) â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      +                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Mockç¡¬ä»¶åº“ (simulator/)                   â”‚          â”‚
â”‚  â”‚    - æ¨¡æ‹Ÿç¡¬ä»¶è¡Œä¸º                          â”‚          â”‚
â”‚  â”‚    - æ— éœ€çœŸå®žFPGA                          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“ éƒ¨ç½²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åµŒå…¥å¼ç›®æ ‡çŽ¯å¢ƒ (ARM)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  BPMIOCæºä»£ç                                â”‚          â”‚
â”‚  â”‚    (ç›¸åŒä»£ç )                               â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      â†“                                    â”‚
â”‚       äº¤å‰ç¼–è¯‘ (arm-linux-gnueabihf-gcc)                  â”‚
â”‚                      â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  bin/linux-arm/BPMmonitor (ARMå¯æ‰§è¡Œæ–‡ä»¶)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      +                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  çœŸå®žç¡¬ä»¶é©±åŠ¨                               â”‚          â”‚
â”‚  â”‚    - FPGAé€šä¿¡                              â”‚          â”‚
â”‚  â”‚    - å®žé™…RFä¿¡å·é‡‡é›†                         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸ºä»€ä¹ˆéœ€è¦äº¤å‰ç¼–è¯‘

| ç‰¹æ€§ | PC (x86_64) | ç›®æ ‡æ¿ (ARM) |
|------|-------------|--------------|
| **CPUæž¶æž„** | Intel/AMD x86_64 | ARM Cortex-A9/A53 |
| **æŒ‡ä»¤é›†** | x86-64 | ARMv7/ARMv8 |
| **äºŒè¿›åˆ¶æ ¼å¼** | ELF x86-64 | ELF ARM |
| **å¯æ‰§è¡Œæ–‡ä»¶** | ä¸å…¼å®¹ â† â†’ ä¸å…¼å®¹ | |

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨PCä¸Šä½¿ç”¨ARMäº¤å‰ç¼–è¯‘å·¥å…·é“¾ç”ŸæˆARMå¯æ‰§è¡Œæ–‡ä»¶

## 2ï¸âƒ£ å¼€å‘çŽ¯å¢ƒ vs ç”Ÿäº§çŽ¯å¢ƒ

### å¯¹æ¯”è¡¨

| ç»´åº¦ | PCå¼€å‘çŽ¯å¢ƒ | åµŒå…¥å¼ç”Ÿäº§çŽ¯å¢ƒ |
|------|-----------|---------------|
| **ç¡¬ä»¶** | PC (x86_64) | ARMæ¿ |
| **æ“ä½œç³»ç»Ÿ** | Ubuntu 20.04 | Petalinux / Buildroot |
| **ç¡¬ä»¶é©±åŠ¨** | Mockåº“ (simulator/) | çœŸå®žFPGAé©±åŠ¨ |
| **ç¼–è¯‘æ–¹å¼** | æœ¬åœ°ç¼–è¯‘ | äº¤å‰ç¼–è¯‘ |
| **å­˜å‚¨** | å¤§å®¹é‡ç¡¬ç›˜ | SDå¡/eMMC (æœ‰é™) |
| **è°ƒè¯•** | GDBæœ¬åœ°è°ƒè¯• | GDBè¿œç¨‹è°ƒè¯• |
| **ç½‘ç»œ** | ä»¥å¤ªç½‘ | ä»¥å¤ªç½‘/ä¸²å£ |
| **å¯åŠ¨æ–¹å¼** | æ‰‹åŠ¨ `./st.cmd` | è‡ªåŠ¨å¯åŠ¨æœåŠ¡ |
| **æ—¥å¿—** | ç»ˆç«¯è¾“å‡º | æ—¥å¿—æ–‡ä»¶ |
| **ç›‘æŽ§** | å¼€å‘æ—¶ç›‘æŽ§ | 24/7ç›‘æŽ§ |
| **æ›´æ–°** | éšæ—¶ç¼–è¯‘ | è®¡åˆ’ç»´æŠ¤çª—å£ |

### å¼€å‘æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¼€å‘é˜¶æ®µ (PC)                          â”‚
â”‚                                                     â”‚
â”‚  ç¼–å†™ä»£ç  â†’ ç¼–è¯‘ â†’ å•å…ƒæµ‹è¯• â†’ Mockåº“æµ‹è¯•            â”‚
â”‚      â†“                                             â”‚
â”‚  é›†æˆæµ‹è¯• â†’ GDBè°ƒè¯• â†’ åŠŸèƒ½éªŒè¯                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              éƒ¨ç½²é˜¶æ®µ (PC â†’ ARM)                    â”‚
â”‚                                                     â”‚
â”‚  é…ç½®äº¤å‰ç¼–è¯‘ â†’ äº¤å‰ç¼–è¯‘ â†’ ä¼ è¾“æ–‡ä»¶ â†’ ç›®æ ‡æ¿æµ‹è¯•    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é›†æˆé˜¶æ®µ (ARM + ç¡¬ä»¶)                  â”‚
â”‚                                                     â”‚
â”‚  è¿žæŽ¥FPGA â†’ ç¡¬ä»¶æµ‹è¯• â†’ æ€§èƒ½è°ƒä¼˜ â†’ ç³»ç»Ÿé›†æˆ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸Šçº¿é˜¶æ®µ (ç”Ÿäº§)                        â”‚
â”‚                                                     â”‚
â”‚  è‡ªåŠ¨å¯åŠ¨ â†’ ç›‘æŽ§é…ç½® â†’ æ–‡æ¡£æ›´æ–° â†’ æ­£å¼è¿è¡Œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3ï¸âƒ£ éƒ¨ç½²æž¶æž„

### å…¸åž‹BPMIOCéƒ¨ç½²æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŠ é€Ÿå™¨æŽ§åˆ¶ç½‘ç»œ                          â”‚
â”‚                   (192.168.1.0/24)                        â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  æ“ä½œå‘˜å·¥ä½œç«™ â”‚       â”‚  å·¥ç¨‹å¸ˆå·¥ä½œç«™ â”‚                 â”‚
â”‚  â”‚              â”‚       â”‚              â”‚                 â”‚
â”‚  â”‚  CS-Studio   â”‚       â”‚  å¼€å‘å·¥å…·     â”‚                 â”‚
â”‚  â”‚  caget/caput â”‚       â”‚  pyepics     â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                      â”‚                          â”‚
â”‚         â”‚  Channel Access      â”‚                          â”‚
â”‚         â”‚  (TCP 5064/5065)     â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                    â”‚                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚         â”‚   IOCæœåŠ¡å™¨ (ARMæ¿)    â”‚                         â”‚
â”‚         â”‚  192.168.1.100        â”‚                         â”‚
â”‚         â”‚                       â”‚                         â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚         â”‚  â”‚  EPICS IOC      â”‚  â”‚                         â”‚
â”‚         â”‚  â”‚  (BPMmonitor)   â”‚  â”‚                         â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚         â”‚           â”‚           â”‚                         â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚         â”‚  â”‚  ç¡¬ä»¶é©±åŠ¨åº“     â”‚  â”‚                         â”‚
â”‚         â”‚  â”‚  (BPMDriver.so) â”‚  â”‚                         â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                     â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚              â”‚  FPGA/ç¡¬ä»¶   â”‚                              â”‚
â”‚              â”‚             â”‚                              â”‚
â”‚              â”‚  - RFé‡‡é›†   â”‚                              â”‚
â”‚              â”‚  - ADC      â”‚                              â”‚
â”‚              â”‚  - å¯„å­˜å™¨   â”‚                              â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–‡ä»¶å¸ƒå±€

#### PCå¼€å‘çŽ¯å¢ƒ

```
/opt/BPMmonitor/                    # BPMIOCæ ¹ç›®å½•
â”œâ”€â”€ configure/
â”‚   â”œâ”€â”€ CONFIG_SITE                 # ç¼–è¯‘é…ç½®
â”‚   â””â”€â”€ RELEASE                     # ä¾èµ–è·¯å¾„
â”œâ”€â”€ BPMmonitorApp/
â”‚   â”œâ”€â”€ src/                        # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ driverWrapper.c
â”‚   â”‚   â”œâ”€â”€ devBPMMonitor.c
â”‚   â”‚   â””â”€â”€ Makefile
â”‚   â””â”€â”€ Db/
â”‚       â””â”€â”€ BPMmonitor.db
â”œâ”€â”€ iocBoot/
â”‚   â””â”€â”€ iocBPMmonitor/
â”‚       â””â”€â”€ st.cmd                  # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ linux-x86_64/               # PCå¯æ‰§è¡Œæ–‡ä»¶
â”‚       â””â”€â”€ BPMmonitor
â”œâ”€â”€ dbd/
â”‚   â””â”€â”€ BPMmonitor.dbd
â””â”€â”€ db/
    â””â”€â”€ BPMmonitor.db

/opt/simulator/                     # Mockåº“
â””â”€â”€ lib/
    â””â”€â”€ libBPMDriver.so             # Mockç¡¬ä»¶åº“
```

#### ARMç›®æ ‡æ¿

```
/opt/BPMmonitor/                    # BPMIOCæ ¹ç›®å½•
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ linux-arm/                  # ARMå¯æ‰§è¡Œæ–‡ä»¶
â”‚       â””â”€â”€ BPMmonitor
â”œâ”€â”€ dbd/
â”‚   â””â”€â”€ BPMmonitor.dbd
â”œâ”€â”€ db/
â”‚   â””â”€â”€ BPMmonitor.db
â””â”€â”€ iocBoot/
    â””â”€â”€ iocBPMmonitor/
        â””â”€â”€ st.cmd

/opt/BPMDriver/                     # çœŸå®žé©±åŠ¨
â””â”€â”€ lib/
    â””â”€â”€ libBPMDriver.so             # FPGAé©±åŠ¨åº“

/var/log/                           # æ—¥å¿—ç›®å½•
â””â”€â”€ bpmioc.log

/etc/systemd/system/                # ç³»ç»ŸæœåŠ¡
â””â”€â”€ bpmioc.service
```

## 4ï¸âƒ£ éƒ¨ç½²æµç¨‹è¯¦è§£

### å®Œæ•´9æ­¥éƒ¨ç½²æµç¨‹

#### æ­¥éª¤1: å‡†å¤‡äº¤å‰ç¼–è¯‘çŽ¯å¢ƒ

```bash
# å®‰è£…ARMäº¤å‰ç¼–è¯‘å·¥å…·é“¾
sudo apt-get install gcc-arm-linux-gnueabihf \
                     g++-arm-linux-gnueabihf \
                     binutils-arm-linux-gnueabihf
```

**è¾“å‡º**ï¼šARMç¼–è¯‘å·¥å…·é“¾ï¼ˆ`arm-linux-gnueabihf-gcc`ï¼‰

#### æ­¥éª¤2: äº¤å‰ç¼–è¯‘EPICS Base

```bash
cd /opt/epics/base
# é…ç½®äº¤å‰ç¼–è¯‘
make CROSS_COMPILER_TARGET_ARCHS=linux-arm
```

**è¾“å‡º**ï¼šARMç‰ˆæœ¬çš„EPICS Baseåº“

#### æ­¥éª¤3: äº¤å‰ç¼–è¯‘BPMIOC

```bash
cd /opt/BPMmonitor
# ç¼–è¾‘ configure/CONFIG_SITE
echo "CROSS_COMPILER_TARGET_ARCHS = linux-arm" >> configure/CONFIG_SITE

make clean
make
```

**è¾“å‡º**ï¼š`bin/linux-arm/BPMmonitor`

#### æ­¥éª¤4: å‡†å¤‡ç›®æ ‡æ¿

```bash
# åœ¨ç›®æ ‡æ¿ä¸Šåˆ›å»ºç›®å½•
ssh root@192.168.1.100
mkdir -p /opt/BPMmonitor
mkdir -p /opt/BPMDriver/lib
mkdir -p /var/log
```

**è¾“å‡º**ï¼šç›®æ ‡æ¿ç›®å½•ç»“æž„

#### æ­¥éª¤5: ä¼ è¾“æ–‡ä»¶

```bash
# ä»ŽPCä¼ è¾“åˆ°ARMæ¿
scp -r bin/linux-arm dbd db iocBoot root@192.168.1.100:/opt/BPMmonitor/
```

**è¾“å‡º**ï¼šæ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡æ¿

#### æ­¥éª¤6: é…ç½®çŽ¯å¢ƒ

```bash
# åœ¨ç›®æ ‡æ¿ä¸Š
ssh root@192.168.1.100

# è®¾ç½®çŽ¯å¢ƒå˜é‡
cat >> ~/.bashrc <<'EOF'
export EPICS_HOST_ARCH=linux-arm
export EPICS_BASE=/opt/epics/base
export PATH=$EPICS_BASE/bin/$EPICS_HOST_ARCH:$PATH
EOF

source ~/.bashrc
```

**è¾“å‡º**ï¼šçŽ¯å¢ƒå˜é‡é…ç½®å®Œæˆ

#### æ­¥éª¤7: æµ‹è¯•è¿è¡Œ

```bash
# åœ¨ç›®æ ‡æ¿ä¸Šæ‰‹åŠ¨å¯åŠ¨IOC
cd /opt/BPMmonitor/iocBoot/iocBPMmonitor
chmod +x st.cmd
./st.cmd
```

**è¾“å‡º**ï¼šIOCå¯åŠ¨æ—¥å¿—

#### æ­¥éª¤8: éªŒè¯åŠŸèƒ½

```bash
# åœ¨PCä¸Šæµ‹è¯•PVè®¿é—®
export EPICS_CA_ADDR_LIST=192.168.1.100
caget LLRF:BPM:RFIn_01_Amp
```

**è¾“å‡º**ï¼šPVå€¼æ­£å¸¸è¯»å–

#### æ­¥éª¤9: é…ç½®è‡ªåŠ¨å¯åŠ¨

```bash
# åˆ›å»ºsystemdæœåŠ¡ï¼ˆè§ 05-startup-config.mdï¼‰
sudo systemctl enable bpmioc
sudo systemctl start bpmioc
```

**è¾“å‡º**ï¼šIOCè‡ªåŠ¨å¯åŠ¨è¿è¡Œ

## 5ï¸âƒ£ ç¡¬ä»¶è¦æ±‚

### æœ€å°ç¡¬ä»¶è¦æ±‚

| ç»„ä»¶ | æœ€å°è¦æ±‚ | æŽ¨èé…ç½® |
|------|----------|----------|
| **CPU** | ARM Cortex-A9 å•æ ¸ @666MHz | ARM Cortex-A53 å››æ ¸ @1.2GHz |
| **å†…å­˜** | 256MB RAM | 1GB+ RAM |
| **å­˜å‚¨** | 512MB (SDå¡) | 8GB+ (eMMC) |
| **ç½‘ç»œ** | 100Mbpsä»¥å¤ªç½‘ | 1Gbpsä»¥å¤ªç½‘ |
| **ä¸²å£** | 1ä¸ª (è°ƒè¯•) | 2ä¸ª+ (è°ƒè¯•+é€šä¿¡) |

### æ”¯æŒçš„ç¡¬ä»¶å¹³å°

#### Raspberry Pi 4

```
åž‹å·: Raspberry Pi 4 Model B
CPU: Broadcom BCM2711, Quad core Cortex-A72 @1.5GHz
å†…å­˜: 2GB/4GB/8GB LPDDR4
ç½‘ç»œ: Gigabit Ethernet
å­˜å‚¨: MicroSD
ä»·æ ¼: ~$35-75
é€‚ç”¨: å¼€å‘æµ‹è¯•ã€å°è§„æ¨¡éƒ¨ç½²
```

#### Xilinx Zynq-7000

```
åž‹å·: Zynq-7020
CPU: Dual-core ARM Cortex-A9 @866MHz
FPGA: Artix-7 FPGA logic
å†…å­˜: 512MB DDR3
ç½‘ç»œ: Gigabit Ethernet
å­˜å‚¨: SD card / QSPI Flash
ä»·æ ¼: ~$200-500 (å¼€å‘æ¿)
é€‚ç”¨: ç”Ÿäº§çŽ¯å¢ƒã€éœ€è¦FPGAå¤„ç†
```

## 6ï¸âƒ£ è½¯ä»¶ä¾èµ–

### ç›®æ ‡æ¿æ“ä½œç³»ç»Ÿ

| æ“ä½œç³»ç»Ÿ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|------|------|----------|
| **Raspbian** | æ˜“ç”¨ã€è½¯ä»¶åŒ…ä¸°å¯Œ | ä½“ç§¯å¤§ | å¼€å‘æµ‹è¯• |
| **Buildroot** | è½»é‡ã€å¯å®šåˆ¶ | éœ€è¦é…ç½® | ç”Ÿäº§çŽ¯å¢ƒ |
| **Petalinux** | Xilinxæ”¯æŒå¥½ | å¤æ‚ | Zynqå¹³å° |
| **RTEMS** | å®žæ—¶æ€§å¼º | ç”Ÿæ€å°‘ | å®žæ—¶è¦æ±‚é«˜ |

### å¿…éœ€çš„ç³»ç»Ÿåº“

```bash
# åœ¨ç›®æ ‡æ¿ä¸Šå®‰è£…
apt-get install -y \
    libreadline7 \
    libncurses5 \
    libstdc++6 \
    libc6
```

### EPICSä¾èµ–

- EPICS Base â‰¥ 3.15.6
- libreadline
- libCom (EPICS)
- libca (Channel Access)

## ðŸŽ¯ éƒ¨ç½²ç­–ç•¥

### ç­–ç•¥1: æ»šåŠ¨éƒ¨ç½²

é€‚ç”¨äºŽå¤šä¸ªç›¸åŒçš„IOC

```
IOC1 â†’ æ›´æ–° â†’ æµ‹è¯• â†’ é€šè¿‡
         â†“
IOC2 â†’ æ›´æ–° â†’ æµ‹è¯• â†’ é€šè¿‡
         â†“
IOC3 â†’ æ›´æ–° â†’ æµ‹è¯• â†’ é€šè¿‡
```

### ç­–ç•¥2: è“ç»¿éƒ¨ç½²

å‡†å¤‡ä¸¤å¥—çŽ¯å¢ƒï¼Œå¿«é€Ÿåˆ‡æ¢

```
è“çŽ¯å¢ƒ (æ—§ç‰ˆæœ¬) â† æ­£åœ¨è¿è¡Œ
ç»¿çŽ¯å¢ƒ (æ–°ç‰ˆæœ¬) â† å‡†å¤‡å¥½
         â†“
    åˆ‡æ¢æµé‡
         â†“
è“çŽ¯å¢ƒ (æ—§ç‰ˆæœ¬) â† å¤‡ç”¨
ç»¿çŽ¯å¢ƒ (æ–°ç‰ˆæœ¬) â† æ­£åœ¨è¿è¡Œ
```

### ç­–ç•¥3: é‡‘ä¸é›€éƒ¨ç½²

å…ˆåœ¨å°èŒƒå›´éªŒè¯

```
1% æµé‡ â†’ æ–°ç‰ˆæœ¬ â†’ ç›‘æŽ§æŒ‡æ ‡ â†’ OK?
         â†“
10% æµé‡ â†’ æ–°ç‰ˆæœ¬ â†’ ç›‘æŽ§æŒ‡æ ‡ â†’ OK?
         â†“
100% æµé‡ â†’ æ–°ç‰ˆæœ¬
```

## ðŸ“ æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥

- [ ] PCå¼€å‘çŽ¯å¢ƒå®Œæ•´æµ‹è¯•é€šè¿‡
- [ ] äº¤å‰ç¼–è¯‘å·¥å…·é“¾å·²å®‰è£…
- [ ] EPICS Baseäº¤å‰ç¼–è¯‘æˆåŠŸ
- [ ] BPMIOCäº¤å‰ç¼–è¯‘æˆåŠŸ
- [ ] ç›®æ ‡æ¿ç¡¬ä»¶å‡†å¤‡å°±ç»ª
- [ ] ç½‘ç»œè¿žé€šæ€§å·²éªŒè¯
- [ ] å¤‡ä»½çŽ°æœ‰é…ç½®

### éƒ¨ç½²åŽéªŒè¯

- [ ] IOCæˆåŠŸå¯åŠ¨
- [ ] PVå¯ä»¥è®¿é—®
- [ ] ç¡¬ä»¶é€šä¿¡æ­£å¸¸
- [ ] æ€§èƒ½æ»¡è¶³è¦æ±‚
- [ ] æ—¥å¿—æ— é”™è¯¯
- [ ] è‡ªåŠ¨å¯åŠ¨å·¥ä½œ
- [ ] ç›‘æŽ§é…ç½®å®Œæˆ

## ðŸ”— ç›¸å…³æ–‡æ¡£

- **[02-cross-compile.md](./02-cross-compile.md)** - è¯¦ç»†çš„äº¤å‰ç¼–è¯‘æ­¥éª¤
- **[03-target-setup.md](./03-target-setup.md)** - ç›®æ ‡æ¿è®¾ç½®
- **[Part 7: æž„å»ºç³»ç»Ÿ](../part7-build-system/)** - Makefileé…ç½®

---

**ä¸‹ä¸€æ­¥**: å­¦ä¹  [äº¤å‰ç¼–è¯‘è¯¦è§£](./02-cross-compile.md)
